

var UIToastrMsn = function() {
    return {
        init: function(type,title,content) {
         
		   toastr.options = {
			  "closeButton": true,
			  "debug": false,
			  "positionClass": "toast-top-center",
			  "onclick": null,
			  "showDuration": "1000",
			  "hideDuration": "1000",
			  "timeOut": "5000",
			  "extendedTimeOut": "1000",
			  "showEasing": "swing",
			  "hideEasing": "linear",
			  "showMethod": "fadeIn",
			  "hideMethod": "fadeOut"
			}		
			//error,warning,info,success
			//toastr[type]("Gnome & Growl type non-blocking notifications", "Toastr Notifications");	
			toastr[type](content,title);		 
        }
    }
}();

var Login = function() {
    var r = function() {
        var e = $("#form_login_principal"),
                r = $(".alert-danger", e),
                i = $(".alert-success", e);
        e.validate({
            errorElement: "span",
            errorClass: "help-block help-block-error",
            focusInvalid: !1,
            ignore: "",
            rules: {
                anio: {
                    required: !0,
                    minlength: 4,
                    maxlength: 4,
                },
                codigo: {
                    required: !0
                },
                username: {
                    required: !0
                },
                password: {
                    required: !0
                },
                remember: {
                    required: !1
                }
            },
            messages: {
                anio: {
                    required: "El año es requerido.",
                    maxlength: "Introduzca un máximo de 4 caracteres", //jQuery.validator.format("Max {0} items allowed for selection"),
                    minlength: "Introduzca un minimo de 4 caracteres",
                },
                codigo: {
                    required: "El codigo es requerido."
                },
                username: {
                    required: "Usuario is requerido."
                },
                password: {
                    required: "Password es requerido."
                }
            },
            invalidHandler: function(e, t) {
                i.hide(), r.show(), App.scrollTo(r, -200)
            },
            errorPlacement: function(e, r) {
                r.is(":checkbox") ? e.insertAfter(r.closest(".md-checkbox-list, .md-checkbox-inline, .checkbox-list, .checkbox-inline")) : r.is(":radio") ? e.insertAfter(r.closest(".md-radio-list, .md-radio-inline, .radio-list,.radio-inline")) : e.insertAfter(r)
            },
            highlight: function(e) {
                $(e).closest(".form-group").addClass("has-error")
            },
            unhighlight: function(e) {
                $(e).closest(".form-group").removeClass("has-error")
            },
            success: function(e) {
                e.closest(".form-group").removeClass("has-error")
            },
            submitHandler: function(e) {
                i.show()
                r.hide()
                $('i.preloader').fadeOut();
            },
        }), $(".login-form input").keypress(function(r) {
            return 13 == r.which ? ($(".login-form").validate().form() && $(".login-form").submit(), !1) : void 0
        }), $(".forget-form input").keypress(function(r) {
            return 13 == r.which ? ($(".forget-form").validate().form() && $(".forget-form").submit(), !1) : void 0
        }), $("#forget-password").click(function() {
            $(".login-form").hide(), $(".forget-form").show()
        }), $("#back-btn").click(function() {
            $(".login-form").show(), $(".forget-form").hide()
        })





    };
    return {
        init: function() {
            r(),                   $(".forget-form").hide(), document.getElementById('anio').focus()



        }
    }
}();


function processKeyAnio(e) {
    if (null == e)
        e = window.event;
    if (e.keyCode == 13) {
        document.getElementById("codigo").select();
        document.getElementById("codigo").focus();
        return false;
    }
}


function processKeyCodigo(e) {
    if (null == e)
        e = window.event;
    if (e.keyCode == 13) {
        document.getElementById("username").select();
        document.getElementById("username").focus();
        return false;
    }
}


function processKeyUser(e) {
    if (null == e)
        e = window.event;
    if (e.keyCode == 13) {
        document.getElementById("password").select();
        document.getElementById("password").focus();
        return false;
    }
}

function processKeyPass(e) {
    if (null == e)
        e = window.event;
    if (e.keyCode == 13) {
        document.getElementById("btnlogin").click();
        return false;
    }
}



$('#btnlogin').click(function() {

    var username = $('input#username').val();
    var password = $('input#password').val();
    var anio = $('input#anio').val();
    var codigo = $('input#codigo').val();
    $('i.preloader').show();

    setTimeout(function() {
        if ($("#form_login_principal").valid()) {
            $.ajax({
                type: 'POST',
                url: url + 'index.php/login/Auth',
                dataType: 'json',
                data:({
                            username: username,
                            password: password,
                            anio: anio,
                            codigo: codigo
                }),
                beforeSend: function() {
                    $('i.preloader').show();
                },
                complete: function() {
                    $('i.preloader').fadeOut();
                },
                success: function(data)
                {
                    if (data.type == "success") {
                        window.location.href = url + "index.php/login/index";
                    }
                    else {
                        UIToastrMsn.init(data.type, data.title, data.content);
                    }
                }
            });
        } else {
            $('i.preloader').fadeOut();
        }
    }, 100);

});




var preloader = {
    cSpeed: 5,
    cWidth: 14,
    cHeight: 14,
    cTotalFrames: 75,
    cFrameWidth: 14,
    cImageSrc: 'https://d2599kud7uucku.cloudfront.net/themes/h2/img/sprites.png?v=2.3.2',
    cImageTimeout: false,
    cIndex: 0,
    cXpos: 0,
    cPreloaderTimeout: false,
    SECONDS_BETWEEN_FRAMES: 0,
    startAnimation: function() {

        $('.preloader').css('background-image', 'url(' + preloader.cImageSrc + ')');

        var FPS = Math.round(100 / preloader.cSpeed);
        preloader.SECONDS_BETWEEN_FRAMES = 1 / FPS;

        preloader.cPreloaderTimeout = setTimeout('preloader.continueAnimation()', preloader.SECONDS_BETWEEN_FRAMES / 1000);

    },
    continueAnimation: function() {

        preloader.cXpos += preloader.cFrameWidth;
        preloader.cIndex += 1;

        if (preloader.cIndex >= preloader.cTotalFrames) {
            preloader.cXpos = 0;
            preloader.cIndex = 0;
        }

        if ($('.preloader').is(':visible')) {
            var css = {};
            var bg = $('.preloader').css('background-image');
            if (bg.indexOf('url') == -1) {
                css['background-image'] = 'url(' + preloader.cImageSrc + ')';
            }
            css['background-position'] = (-preloader.cXpos) + 'px 0';
            $('.preloader').css(css);
        }

        preloader.cPreloaderTimeout = setTimeout('preloader.continueAnimation()', preloader.SECONDS_BETWEEN_FRAMES * 1000);
    },
    stopAnimation: function() {
        clearTimeout(preloader.cPreloaderTimeout);
        preloader.cPreloaderTimeout = false;
    },
    imageLoader: function(s, fun)
    {

        clearTimeout(preloader.cImageTimeout);
        preloader.cImageTimeout = 0;
        var genImage = new Image();
        genImage.onload = function() {
            preloader.cImageTimeout = setTimeout(fun, 0)
        };
        genImage.src = s;
    },
    init: function() {
        new preloader.imageLoader(preloader.cImageSrc, 'preloader.startAnimation()');
    }
}





jQuery(document).ready(function() {
    preloader.init();
    Login.init();

});






